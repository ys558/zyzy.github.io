---
title: åˆ›å»ºè‡ªå·±çš„node cli
date: 2021-10-17 22:18:15
tags:
	- node cli
---

ç»å¸¸ä½¿ç”¨`create-react-app`ä½œä¸ºå‘½ä»¤è¡Œç”Ÿæˆé¡¹ç›®ï¼Œæ€»æƒ³ç€è‡ªå·±èƒ½é…ç½®ä¸€ä¸ªå±äºè‡ªå·±çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¾ˆé…·ç‚«çš„æ ·å­ã€‚æœ€è¿‘æœ‰æ—¶é—´ï¼Œç»ˆäºæ¥å®ç°äº†

<!-- more -->

## åˆå§‹åŒ–é¡¹ç›®
```bash
mkdir y-cli && cd y-cli
npm init -y
```

## æ ¸å¿ƒæ­¥éª¤ `npm link`

æ–°å»ºä¸€ä¸ªæ–‡ä»¶ `./bin/ych.js`ï¼Œå¹¶å†™ä¸€ç‚¹ç®€å•çš„ä¸œè¥¿  
```js
// è¿™é‡Œå‘Šè¯‰ç³»ç»Ÿè¦ä»¥nodeç¯å¢ƒæ‰§è¡Œï¼š
#!/usr/bin/env node

console.log('hello,node cli!')
```

å†åœ¨ `package.json` é‡Œæ·»åŠ  `bin` é…ç½®ï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰å‘½ä»¤ï¼Œå¦‚ `y-cli`
```json
  "bin": {
    "y-cli": "./bin/ych.js"
  }
```

åœ¨å‘½ä»¤è¡Œé‡Œè¿è¡Œï¼š

```bash
npm link
# æˆ–è€…åœ¨å…¨å±€installï¼š
npm install . -g
```

å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ï¼Œnpmå°†å‘½ä»¤ä½œä¸ºè½¯é“¾æ¥è¿æ¥è‡³å¯¹åº”çš„jsæ–‡ä»¶
```bash
xxx@xxxMBP y-cli % sudo npm link
npm WARN y-cli@1.0.0 No description
npm WARN y-cli@1.0.0 No repository field.

up to date in 0.832s
found 0 vulnerabilities

/usr/local/bin/ych -> /usr/local/lib/node_modules/y-cli/bin/ych.js
/usr/local/lib/node_modules/y-cli -> /Users/xxx/Documents/code/y-cli
```

## æ‰€ç”¨åˆ°çš„åº“
cliéœ€è¦è·å–ç”¨æˆ·çš„è¾“å…¥ï¼Œé€‰æ‹©å¹¶åšç›¸åº”çš„äº‹æƒ…ï¼Œå°±éœ€è¦ä½¿ç”¨åˆ°ä¸€äº›åº“æ¥å¸®å¿™æˆ‘ä»¬æ›´æ–¹ä¾¿çš„å†™cli

æ ¸å¿ƒï¼š
- commander - å¤„ç†æ ¸å¿ƒå‘½ä»¤ ä¸»è¦æ¨¡å—ï¼Œåœ¨ç»ˆç«¯è¾“å‡ºå„ç§ä¿¡æ¯å…¨é è¿™ä¸ªæ¨¡å—
- download-git-repo - ä¸‹è½½gitæ¨¡å—

ç¾åŒ–ï¼š
- chalk â€Šâ€”â€Š ç¾åŒ–ç»ˆç«¯å­—ç¬¦æ˜¾ç¤º
- figletâ€Š â€”â€Š åœ¨ç»ˆç«¯è¾“å‡ºå¤§å‹å­—ç¬¦
- inquirer â€Šâ€”â€Š å‘½ä»¤è¡Œå‚æ•°è¾“å…¥äº¤äº’
- shelljs â€Šâ€”â€Š åœ¨jsæ–‡ä»¶å†™å‘½ä»¤è¡Œ
- ora - å®è¡Œloadingæ•ˆæœ

è®©æˆ‘ä»¬æ¥æŠŠè¿™äº›åº“å…¨éƒ¨å®‰è£…ä¸€é

## commander

æ ¹æ®[commanderæ–‡æ¡£](https://github.com/tj/commander.js/blob/master/Readme_zh-CN.md#%e5%b8%b8%e7%94%a8%e9%80%89%e9%a1%b9%e7%b1%bb%e5%9e%8bboolean-%e5%9e%8b%e9%80%89%e9%a1%b9%e5%92%8c%e5%b8%a6%e5%8f%82%e6%95%b0%e9%80%89%e9%a1%b9)çš„ä¸€äº›å‚æ•°ï¼Œæˆ‘ä»¬æ¥ç¼–å†™è„šæœ¬ `ych.js`


```js
#!/usr/bin/env node
const program = require('commander')

// è·å–package.jsonä¸­çš„ç‰ˆæœ¬ä¿¡æ¯
program.version(require("../package.json").version)

// è§£ææŒ‡ä»¤ï¼Œè¿™ç‚¹å¾ˆé‡è¦  ä¸è§£ææŒ‡ä»¤åˆ™æ— æ•ˆ
program.parse(process.argv)
```

commanderè‡ªå¸¦ `-V` å’Œ `-h` ä¸¤ä¸ªå‘½ä»¤ï¼Œè¿è¡Œ `ych -h`å¯çœ‹åˆ°ï¼š

```bash
xxx@xxxdeMacBook-Pro y-cli % ych -h
Usage: ych [options]

Options:
  -V, --version  output the version number
  -h, --help     display help for command
```

`.option()` åŠ å…¥è‡ªå®šä¹‰å‘½ä»¤

```js
program.option('-d, --description', 'ych è„šæ‰‹æ¶ç®€ä»‹ï¼šã€‚ã€‚ã€‚ã€‚')
```

å¯ä»¥å‘ç°å·²ç»åŠ ä¸Šè¯¥å‘½ä»¤ï¼š

```bash
xxx@xxxdeMacBook-Pro y-cli % ych -h
Usage: ych [options]

Options:
  -V, --version      output the version number
  -d, --description  ych è„šæ‰‹æ¶ç®€ä»‹ï¼šã€‚ã€‚ã€‚ã€‚
  -h, --help         display help for command
```

`.command()` è‡ªå®šä¹‰å‘½ä»¤ï¼Œ

åŸºç¡€æ ¼å¼ï¼š

```
program.option('hello <param1> [param2]')
```

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå°–æ‹¬å·`<>`é‡Œçš„å‚æ•°æ˜¯å¿…å¡«å‚æ•°ï¼Œæ–¹æ‹¬å·`[]`é‡Œçš„å‚æ•°æ˜¯å¯é€‰å‚æ•°

åˆ©ç”¨`.command()`å†™ä¸€ä¸ªç®€å•çš„demoï¼Œå¼„æ¸…æ•´ä¸ªåŸºç¡€æµç¨‹ï¼š
```js
program
	.command('hello <param1> [param2]')
  // å‘½ä»¤é‡Œåˆ©ç”¨.usage()å‚æ•°åŒ–ï¼Œä¾›åé¢çš„.action()å›è°ƒä½¿ç”¨ï¼š
	.usage('<command> <param1> [param2]')
  // å›è°ƒå¤„ç†ï¼š
	.action((param1, param2)=>{
		console.log(param1);
		console.log(param2);
	})
```

```bash
ziyouzhiyi@ziyouzhiyideMacBook-Pro y-cli % ych hello
error: missing required argument 'param1'
ziyouzhiyi@ziyouzhiyideMacBook-Pro y-cli % ych hello t 
t
undefined
ziyouzhiyi@ziyouzhiyideMacBook-Pro y-cli % ych hello t y
t
y
```

ä¸Šé¢è¿™äº›å‚æ•°ä¹Ÿå¯é€šè¿‡`.option()`æ¥å®ç°ï¼Œä½†éœ€è¦åŠ ä¸Š`-`ï¼Œå¦‚`-react`ï¼Œå¦‚ä»¥ä¸‹çš„ä¾‹å­ï¼Œåˆ©ç”¨å‚æ•°åˆ›å»ºé¡¹ç›®ï¼š

```js
program.command('create <projectName>')
	.option('-react')
	.option('-vue')
	.action((projectName, option) => {
		const type = Object.keys(option)[0]
		switch(type) {
			case "Vue":
				console.log("åˆ›å»ºvueé¡¹ç›®")
				break;
			case "React":
				console.log("åˆ›å»ºreacté¡¹ç›®")
				break;
			default:
				console.log("æœªæ·»åŠ å‚æ•°ï¼Œä¸èƒ½ä¸‹è½½")
		}
	})
```

æ‰§è¡Œå‘½ä»¤åå¯ä»¥çœ‹åˆ°æ‰“å°ï¼š

```bash
ziyouzhiyi@ziyouzhiyideMacBook-Pro y-cli % ych create test -react
åˆ›å»ºreacté¡¹ç›®
```

## download-git-repo
ä¸‹è½½çš„æ­¥éª¤æŠŠä»–æ›¿æ¢æˆçœŸçš„ä»“åº“ï¼Œéœ€è¦ç”¨åˆ° `download-git-repo` åº“

æŠŠconsole.logæ›¿æ¢æˆçœŸå®çš„gitä»“åº“

```js
...
  case "React":
    download(
			// æ­¤å¤„åº”åŠ ä¸Š #main åˆ†æ”¯åç§°ï¼Œå¦åˆ™æ§åˆ¶å°ä¼šæ˜¾ç¤ºæŠ¥é”™
      'direct:git@github.com:ys558/ych-template.git#main',
      projectName,
      { clone: true },
      (err, x) => {
        // é”™è¯¯å›è°ƒï¼š
        if (err) console.log(err)
        console.log(`${projectName} é¡¹ç›®åˆ›å»ºæˆåŠŸ`)
      }
    )
    break;
  default:
    console.log("æœªæ·»åŠ å‚æ•°ï¼Œä¸èƒ½ä¸‹è½½")
...
```

## [inquirer](https://github.com/SBoudrias/Inquirer.js)
ğŸ‘†çš„æ­¥éª¤ä¸‹è½½çš„ä»“åº“æ˜¯åœ¨å‘½ä»¤è¡Œä¸‹ç›´æ¥å®Œæˆçš„ï¼Œå¦‚æœè¦åƒvueä¸€æ ·èƒ½è®©ç”¨æˆ·è¾“å…¥ç”Ÿæˆçš„ï¼Œå¯ä»¥ç”¨è¯¥åº“ï¼Œæˆ‘ä»¬æŠŠä»£ç æ”¹é€ ä¸€ä¸‹ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨ `.action()` çš„å›è°ƒä¸­è¿›è¡Œå¤„ç†

```js
const questions = [
	{
		type: 'input',
		name: 'projectName',
		message: 'è¯·è¾“å…¥é¡¹ç›®åç§°',
	},
	{
		type: 'list',
		name: 'frameWork',
		message: 'è¯·é€‰æ‹©æ¡†æ¶',
		default: 'React',
		choices: ['React','Vue']
	},
]

program
	.command('create')
	.action(() => {
		inquirer.prompt(questions)
			.then(({projectName, frameWork}) => {
				switch (frameWork) {
					case 'React':
						download(
							'direct:git@github.com:ys558/ych-template.git',
							projectName,
							{ clone: true },
							(err) => {
								// é”™è¯¯å›è°ƒï¼š
								if (err) console.log(err)
								console.log(`${projectName} é¡¹ç›®åˆ›å»ºæˆåŠŸ`)
							})
						break;
					case 'Vue':
						download(
							'direct:git@github.com:ys558/ych-template.git',
							projectName,
							{ clone: true },
							(err) => {
								// é”™è¯¯å›è°ƒï¼š
								if (err) console.log(err)
								console.log(`${projectName} é¡¹ç›®åˆ›å»ºæˆåŠŸ`)
							})
						break;
					default:
						break;
				}
			})
	})
```

## ç¾åŒ–

### [`chalk`](https://github.com/chalk/chalk)ï¼Œ[`figlet`](https://github.com/patorjk/figlet.js)
ç¾åŒ–ç»ˆç«¯å­—ä½“ï¼Œå¦‚ `chalk`:

```js
	if (err) {
		console.log(chalk.bgYellow(err))
		return
	}else{
		console.log(`${chalk.bgGrey(projectName)} ${chalk.greenBright('é¡¹ç›®åˆ›å»ºæˆåŠŸ')}`)
	}
```

`figlet`:

```js
figlet.defaults({font: 'Standard'})
function logo(){
	console.log(figlet.textSync('hi ych!'))
}
```

### [`ora`](https://github.com/sindresorhus/ora)
è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒéº»çƒ¦çš„æ¨¡å—ï¼Œä»–æ˜¯ `es module` ç±»å‹çš„`import`å¯¼å…¥æ¨¡å—ï¼Œè€Œ node ç”¨çš„æ˜¯`commonjs` çš„ `require` å¯¼å…¥æ¨¡å—ï¼Œè€Œä¸”é¡»åœ¨ `package.json` é‡Œæ·»åŠ  `{ "type" : "module" }` æ‰èƒ½æ­£å¸¸åŠ è½½ï¼Œ

## [å®Œæ•´ä»£ç ä»“åº“](https://github.com/ys558/my-node-cli-ych)

